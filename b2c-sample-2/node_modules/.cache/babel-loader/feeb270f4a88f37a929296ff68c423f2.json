{"ast":null,"code":"/*! @azure/msal-browser v2.16.0 2021-07-22 */\n'use strict';\n\nimport { __extends } from '../_virtual/_tslib.js';\nimport { StringUtils, UrlString } from '@azure/msal-common';\nimport { InteractionHandler } from './InteractionHandler.js';\nimport { BrowserAuthError } from '../error/BrowserAuthError.js';\nimport { TemporaryCacheKeys, BrowserConstants } from '../utils/BrowserConstants.js';\nimport { PopupUtils } from '../utils/PopupUtils.js';\nimport { BrowserUtils } from '../utils/BrowserUtils.js';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\n/**\r\n * This class implements the interaction handler base class for browsers. It is written specifically for handling\r\n * popup window scenarios. It includes functions for monitoring the popup window for a hash.\r\n */\nvar PopupHandler = /** @class */function (_super) {\n  __extends(PopupHandler, _super);\n  function PopupHandler(authCodeModule, storageImpl, authCodeRequest, browserRequestLogger) {\n    var _this = _super.call(this, authCodeModule, storageImpl, authCodeRequest, browserRequestLogger) || this;\n    // Properly sets this reference for the unload event.\n    _this.popupUtils = new PopupUtils(storageImpl, browserRequestLogger);\n    return _this;\n  }\n  /**\r\n   * Opens a popup window with given request Url.\r\n   * @param requestUrl\r\n   */\n  PopupHandler.prototype.initiateAuthRequest = function (requestUrl, params) {\n    // Check that request url is not empty.\n    if (!StringUtils.isEmpty(requestUrl)) {\n      // Set interaction status in the library.\n      this.browserStorage.setTemporaryCache(TemporaryCacheKeys.INTERACTION_STATUS_KEY, BrowserConstants.INTERACTION_IN_PROGRESS_VALUE, true);\n      this.browserRequestLogger.infoPii(\"Navigate to: \" + requestUrl);\n      // Open the popup window to requestUrl.\n      return this.popupUtils.openPopup(requestUrl, params.popupName, params.popup);\n    } else {\n      // Throw error if request URL is empty.\n      this.browserRequestLogger.error(\"Navigate url is empty\");\n      throw BrowserAuthError.createEmptyNavigationUriError();\n    }\n  };\n  /**\r\n   * Monitors a window until it loads a url with a known hash, or hits a specified timeout.\r\n   * @param popupWindow - window that is being monitored\r\n   * @param timeout - milliseconds until timeout\r\n   */\n  PopupHandler.prototype.monitorPopupForHash = function (popupWindow) {\n    var _this = this;\n    return this.popupUtils.monitorPopupForSameOrigin(popupWindow).then(function () {\n      var contentHash = popupWindow.location.hash;\n      BrowserUtils.clearHash(popupWindow);\n      _this.popupUtils.cleanPopup(popupWindow);\n      if (!contentHash) {\n        throw BrowserAuthError.createEmptyHashError(popupWindow.location.href);\n      }\n      if (UrlString.hashContainsKnownProperties(contentHash)) {\n        return contentHash;\n      } else {\n        throw BrowserAuthError.createHashDoesNotContainKnownPropertiesError();\n      }\n    });\n  };\n  return PopupHandler;\n}(InteractionHandler);\nexport { PopupHandler };","map":{"version":3,"mappings":";;;;;;;;;;;AAAA;;;;AAkBA;;;;;EAIkCA;EAG9B,sBAAYC,cAAuC,EAAEC,WAAgC,EAAEC,eAA+C,EAAEC,oBAA4B;IAApK,YACIC,kBAAMJ,cAAc,EAAEC,WAAW,EAAEC,eAAe,EAAEC,oBAAoB,CAAC;;IAGzEE,KAAI,CAACC,UAAU,GAAG,IAAIC,UAAU,CAACN,WAAW,EAAEE,oBAAoB,CAAC;;;;;;;EAOvEK,0CAAmB,GAAnB,UAAoBC,UAAkB,EAAEC,MAAmB;;IAEvD,IAAI,CAACC,WAAW,CAACC,OAAO,CAACH,UAAU,CAAC,EAAE;;MAElC,IAAI,CAACI,cAAc,CAACC,iBAAiB,CAACC,kBAAkB,CAACC,sBAAsB,EAAEC,gBAAgB,CAACC,6BAA6B,EAAE,IAAI,CAAC;MACtI,IAAI,CAACf,oBAAoB,CAACgB,OAAO,CAAC,kBAAgBV,UAAY,CAAC;;MAE/D,OAAO,IAAI,CAACH,UAAU,CAACc,SAAS,CAACX,UAAU,EAAEC,MAAM,CAACW,SAAS,EAAEX,MAAM,CAACY,KAAK,CAAC;KAC/E,MAAM;;MAEH,IAAI,CAACnB,oBAAoB,CAACoB,KAAK,CAAC,uBAAuB,CAAC;MACxD,MAAMC,gBAAgB,CAACC,6BAA6B,EAAE;;GAE7D;;;;;;EAODjB,0CAAmB,GAAnB,UAAoBkB,WAAmB;IAAvC;IACI,OAAO,IAAI,CAACpB,UAAU,CAACqB,yBAAyB,CAACD,WAAW,CAAC,CAACE,IAAI,CAAC;MAC/D,IAAMC,WAAW,GAAGH,WAAW,CAACI,QAAQ,CAACC,IAAI;MAC7CC,YAAY,CAACC,SAAS,CAACP,WAAW,CAAC;MACnCrB,KAAI,CAACC,UAAU,CAAC4B,UAAU,CAACR,WAAW,CAAC;MAEvC,IAAI,CAACG,WAAW,EAAE;QACd,MAAML,gBAAgB,CAACW,oBAAoB,CAACT,WAAW,CAACI,QAAQ,CAACM,IAAI,CAAC;;MAG1E,IAAIC,SAAS,CAACC,2BAA2B,CAACT,WAAW,CAAC,EAAE;QACpD,OAAOA,WAAW;OACrB,MAAM;QACH,MAAML,gBAAgB,CAACe,4CAA4C,EAAE;;KAE5E,CACA;GACJ;EACL,mBAAC;AAAD,CApDA,CAAkCC,kBAAkB","names":["__extends","authCodeModule","storageImpl","authCodeRequest","browserRequestLogger","_super","_this","popupUtils","PopupUtils","PopupHandler","requestUrl","params","StringUtils","isEmpty","browserStorage","setTemporaryCache","TemporaryCacheKeys","INTERACTION_STATUS_KEY","BrowserConstants","INTERACTION_IN_PROGRESS_VALUE","infoPii","openPopup","popupName","popup","error","BrowserAuthError","createEmptyNavigationUriError","popupWindow","monitorPopupForSameOrigin","then","contentHash","location","hash","BrowserUtils","clearHash","cleanPopup","createEmptyHashError","href","UrlString","hashContainsKnownProperties","createHashDoesNotContainKnownPropertiesError","InteractionHandler"],"sources":["../../src/interaction_handler/PopupHandler.ts"],"sourcesContent":["/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { UrlString, StringUtils, CommonAuthorizationCodeRequest, AuthorizationCodeClient, Logger } from \"@azure/msal-common\";\r\nimport { InteractionHandler, InteractionParams } from \"./InteractionHandler\";\r\nimport { BrowserAuthError } from \"../error/BrowserAuthError\";\r\nimport { BrowserConstants, TemporaryCacheKeys } from \"../utils/BrowserConstants\";\r\nimport { BrowserCacheManager } from \"../cache/BrowserCacheManager\";\r\nimport { PopupUtils } from \"../utils/PopupUtils\";\r\nimport { BrowserUtils } from \"../utils/BrowserUtils\";\r\n\r\nexport type PopupParams = InteractionParams & {\r\n    popup?: Window|null;\r\n    popupName: string\r\n};\r\n\r\n/**\r\n * This class implements the interaction handler base class for browsers. It is written specifically for handling\r\n * popup window scenarios. It includes functions for monitoring the popup window for a hash.\r\n */\r\nexport class PopupHandler extends InteractionHandler {\r\n    private popupUtils: PopupUtils;\r\n\r\n    constructor(authCodeModule: AuthorizationCodeClient, storageImpl: BrowserCacheManager, authCodeRequest: CommonAuthorizationCodeRequest, browserRequestLogger: Logger) {\r\n        super(authCodeModule, storageImpl, authCodeRequest, browserRequestLogger);\r\n\r\n        // Properly sets this reference for the unload event.\r\n        this.popupUtils = new PopupUtils(storageImpl, browserRequestLogger);\r\n    }\r\n\r\n    /**\r\n     * Opens a popup window with given request Url.\r\n     * @param requestUrl\r\n     */\r\n    initiateAuthRequest(requestUrl: string, params: PopupParams): Window {\r\n        // Check that request url is not empty.\r\n        if (!StringUtils.isEmpty(requestUrl)) {\r\n            // Set interaction status in the library.\r\n            this.browserStorage.setTemporaryCache(TemporaryCacheKeys.INTERACTION_STATUS_KEY, BrowserConstants.INTERACTION_IN_PROGRESS_VALUE, true);\r\n            this.browserRequestLogger.infoPii(`Navigate to: ${requestUrl}`);\r\n            // Open the popup window to requestUrl.\r\n            return this.popupUtils.openPopup(requestUrl, params.popupName, params.popup);\r\n        } else {\r\n            // Throw error if request URL is empty.\r\n            this.browserRequestLogger.error(\"Navigate url is empty\");\r\n            throw BrowserAuthError.createEmptyNavigationUriError();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Monitors a window until it loads a url with a known hash, or hits a specified timeout.\r\n     * @param popupWindow - window that is being monitored\r\n     * @param timeout - milliseconds until timeout\r\n     */\r\n    monitorPopupForHash(popupWindow: Window): Promise<string> {\r\n        return this.popupUtils.monitorPopupForSameOrigin(popupWindow).then(() => {\r\n            const contentHash = popupWindow.location.hash;\r\n            BrowserUtils.clearHash(popupWindow);\r\n            this.popupUtils.cleanPopup(popupWindow);\r\n\r\n            if (!contentHash) {\r\n                throw BrowserAuthError.createEmptyHashError(popupWindow.location.href);\r\n            }\r\n\r\n            if (UrlString.hashContainsKnownProperties(contentHash)) {\r\n                return contentHash;\r\n            } else {\r\n                throw BrowserAuthError.createHashDoesNotContainKnownPropertiesError();\r\n            }\r\n        }\r\n        );\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}